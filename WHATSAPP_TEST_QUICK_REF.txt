â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  WHATSAPP AI PARALLEL PROCESSING - QUICK REF                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ WHAT TO TEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Core Concept: Commands should work DURING upload flow, not interrupt it
âœ… Key Behavior: Upload state is PRESERVED when commands execute
âœ… Success Criteria: Upload continues normally after command completes

ğŸ“‹ 6 PARALLEL SCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  UPLOAD + SALES REPORT
    Start: "Upload Brio 2020"
    During: Provide some data (color, price, etc.)
    Command: "sales report"
    Continue: Provide more data (KM, transmission)
    Result: PDF sent + upload still active

2ï¸âƒ£  UPLOAD + LOW STOCK
    Start: "Upload Avanza 2019"
    During: Any stage of data collection
    Command: "stok" or "inventory"
    Continue: Continue providing vehicle data
    Result: Stock report + upload preserved

3ï¸âƒ£  UPLOAD + EDIT VEHICLE
    Start: "Upload NMAX 2022"
    During: Mid-upload conversation
    Command: "ganti [vehicle]" or "edit [vehicle]"
    After edit: Cancel or complete edit
    Continue: Resume upload with next data point
    Result: Edit works + upload not lost

4ï¸âƒ£  UPLOAD + STATUS CHECK
    Start: "Upload Pajero 2021"
    During: Data collection phase
    Command: "status"
    Continue: Provide missing vehicle details
    Result: Status report + upload continues

5ï¸âƒ£  UPLOAD + SALES METRICS
    Start: "Upload Jazz 2020"
    During: Any upload stage
    Command: "metrics penjualan"
    Continue: Continue upload flow
    Result: PDF sent + upload intact

6ï¸âƒ£  UPLOAD + STAFF PERFORMANCE
    Start: "Upload Ertiga 2023"
    During: Providing vehicle data
    Command: "laporan staff" or "staff performance"
    Continue: Continue with upload details
    Result: PDF sent + upload preserved

ğŸš€ AVAILABLE COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š PDF REPORTS (Admin/Owner Only):
   â€¢ "sales report"           â†’ Sales Summary PDF
   â€¢ "whatsapp ai"            â†’ WhatsApp Analytics PDF
   â€¢ "metrics penjualan"      â†’ Sales Metrics PDF
   â€¢ "metrics pelanggan"      â†’ Customer Metrics PDF
   â€¢ "metrics operational"    â†’ Operational Metrics PDF
   â€¢ "laporan staff"          â†’ Staff Performance PDF
   â€¢ "laporan inventory"      â†’ Inventory Report PDF

ğŸ”§ UNIVERSAL TOOLS (All Staff):
   â€¢ "upload"                 â†’ Start vehicle upload
   â€¢ "stok" / "inventory"     â†’ Check stock levels
   â€¢ "status"                 â†’ System status
   â€¢ "statistik" / "laporan"  â†’ Statistics overview
   â€¢ "edit" / "ubah" / "ganti" â†’ Edit vehicles

ğŸ§ª TEST SEQUENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Verify User Registration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
curl "https://primamobil.id/api/v1/debug/check-user?phone=628YOURNUMBER"

Expected:
  "found": true,
  "canAccessPDF": true,
  "canAccessTools": true

Step 2: Test Each Scenario
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Follow the 6 scenarios in order
Verify PDF is sent
Verify upload continues
Check no errors in logs

Step 3: Test Edge Cases
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Multiple commands in one upload
â€¢ Command at start of upload
â€¢ Command right before completion
â€¢ Staff role using basic tools

Step 4: Document Results
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Fill out WHATSAPP_PARALLEL_TEST_GUIDE.md
Report any issues found
Attach server logs

ğŸ” DEBUG COMMANDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Test PDF generation
curl "https://primamobil.id/api/v1/debug/test-whatsapp-sales-summary" -o test.pdf

# Check user registration (0-prefix)
curl "https://primamobil.id/api/v1/debug/check-user?phone=081234567890"

# Check user registration (62-prefix)
curl "https://primamobil.id/api/v1/debug/check-user?phone=6281234567890"

# Monitor server logs (SSH)
journalctl -u nextjs -f | grep -E "Orchestrator|Command|PARALLEL"

âœ… SUCCESS INDICATORS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Server Logs Should Show:
  [Orchestrator] ğŸ¤– WhatsApp AI Command detected - processing with PARALLEL mode
  [Orchestrator] ğŸ“Š Current conversation state: upload_vehicle
  [CommandHandler] Processing command: [command name]
  [PDF] Generating PDF...
  âœ… PDF generated successfully

User Should See:
  â­ PDF document received in WhatsApp
  â­ Upload flow continues smoothly
  â­ No "start over" or "flow interrupted" messages
  â­ Can continue providing vehicle data

âš ï¸ COMMON ISSUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Issue: Command not recognized
Fix: Check user roleLevel >= 90 for PDF commands
     Verify command spelling matches exactly

Issue: Upload state lost
Fix: Verify commit 40da9b9 is deployed
     Check logs show "PARALLEL mode"

Issue: PDF not sending
Fix: Test PDF generation endpoint
     Check Aimeow configuration
     Verify WhatsApp API credits

Issue: User not found
Fix: Test phone number format
     Verify user registration in dashboard
     Check phone matching logic

ğŸ“ KEY CHANGES IN DEPLOYMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Parallel Processing Architecture (commit 40da9b9)
  â€¢ Commands checked FIRST (line 201)
  â€¢ Upload state preserved during commands
  â€¢ No confirmation patterns needed
  â€¢ Escape patterns only for greetings

âœ“ Phone Number Normalization (commit 0d2d86c)
  â€¢ 3-format matching: 08..., 62..., exact
  â€¢ OR query for flexible lookup
  â€¢ Debug endpoint for testing

âœ“ Role-Based Access Control (commit 99d9f89)
  â€¢ SALES (30+) â†’ basic tools
  â€¢ ADMIN (90+) â†’ PDF reports
  â€¢ "laporan" command added

âœ“ KM Optional (commit 6af9f26)
  â€¢ KM removed from required fields
  â€¢ Can be edited later
  â€¢ Upload no longer blocks on KM

ğŸ“ TEST TIPS
â•â•â•â•â•â•â•â•â•â•â•â•

1. Test with REAL WhatsApp number
2. Use OWNER/ADMIN account for PDF commands
3. Use SALES account for basic commands
4. Test in order: Scenario 1 â†’ 6
5. Wait for each response before next command
6. Document any deviations from expected behavior
7. Collect server logs for debugging

ğŸ“ NEED HELP?
â•â•â•â•â•â•â•â•â•â•â•â•â•

If issues found:
1. Document exact steps taken
2. Copy server logs
3. Screenshot WhatsApp conversation
4. Check WHATSAPP_PARALLEL_TEST_GUIDE.md for solutions
5. Report in GitHub issues or team chat

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  READY TO TEST? Start with Scenario 1 and work through each one! ğŸš€          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
