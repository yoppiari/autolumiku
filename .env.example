# ==============================================================================
# AutoLumiku Platform - Environment Variables Template
# ==============================================================================
# Copy this file to .env and fill in your actual values
# IMPORTANT: Never commit .env file to version control
# ==============================================================================

# ------------------------------------------------------------------------------
# DATABASE CONFIGURATION
# ------------------------------------------------------------------------------
# PostgreSQL connection string
# Format: postgresql://USERNAME:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
DATABASE_URL="postgresql://postgres:password@localhost:5432/autolumiku?schema=public"

# Database connection pool settings (optional)
# DATABASE_URL="postgresql://user:pass@localhost:5432/db?schema=public&connection_limit=20&pool_timeout=10"

# ------------------------------------------------------------------------------
# AUTHENTICATION & SECURITY
# ------------------------------------------------------------------------------
# JWT Secrets (REQUIRED - Generate with: openssl rand -hex 64)
# CRITICAL: Use different secrets for access and refresh tokens
JWT_SECRET="change-this-to-a-secure-random-64-character-hex-string"
JWT_REFRESH_SECRET="change-this-to-a-different-secure-random-64-character-hex-string"

# JWT Token Expiry (optional - defaults shown)
JWT_EXPIRES_IN="15m"                    # Access token expiry (15 minutes)
JWT_REFRESH_EXPIRES_IN="7d"             # Refresh token expiry (7 days)

# Session Secret (REQUIRED - Generate with: openssl rand -hex 64)
SESSION_SECRET="change-this-to-a-secure-random-64-character-hex-string"

# Password Hashing
BCRYPT_ROUNDS=12                        # Bcrypt cost factor (10-14 recommended)

# Session Configuration
SESSION_TIMEOUT=1800                    # Session timeout in seconds (30 minutes)
REFRESH_TOKEN_EXPIRY=604800             # Refresh token expiry in seconds (7 days)
MAX_LOGIN_ATTEMPTS=5                    # Maximum failed login attempts before lockout
ACCOUNT_LOCK_DURATION=1800              # Account lock duration in seconds (30 minutes)

# ------------------------------------------------------------------------------
# EMAIL SERVICE CONFIGURATION
# ------------------------------------------------------------------------------
# Email Provider: console, sendgrid, ses, smtp
EMAIL_PROVIDER="console"

# From Email Address
EMAIL_FROM="noreply@autolumiku.com"
EMAIL_FROM_NAME="AutoLumiku"

# SendGrid Configuration (if EMAIL_PROVIDER=sendgrid)
SENDGRID_API_KEY=""

# AWS SES Configuration (if EMAIL_PROVIDER=ses)
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_REGION="ap-southeast-1"             # Singapore region for Indonesian users
AWS_SES_FROM_EMAIL=""

# SMTP Configuration (if EMAIL_PROVIDER=smtp)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_SECURE="false"                     # true for 465, false for other ports
SMTP_USER=""
SMTP_PASS=""                            # Use app password for Gmail

# ------------------------------------------------------------------------------
# PAYMENT GATEWAY - MIDTRANS
# ------------------------------------------------------------------------------
# Midtrans Configuration
MIDTRANS_SERVER_KEY=""                  # Get from Midtrans Dashboard
MIDTRANS_CLIENT_KEY=""                  # Get from Midtrans Dashboard
MIDTRANS_IS_PRODUCTION="false"          # Set to "true" in production

# Midtrans Sandbox Credentials (for testing):
# Server Key: https://dashboard.sandbox.midtrans.com/settings/config_info
# Client Key: https://dashboard.sandbox.midtrans.com/settings/config_info

# ------------------------------------------------------------------------------
# APPLICATION CONFIGURATION
# ------------------------------------------------------------------------------
# Node Environment
NODE_ENV="development"                  # development, production, test

# MULTI-TENANT NOTE:
# Domains are dynamically resolved per tenant from the database.
# Each tenant can have:
# - Custom domain (e.g., showroom1.com) stored in Tenant.domain or TenantBranding.customDomain
# - Subdomain (e.g., showroom1.autolumiku.com) stored in TenantBranding.subdomain
# No need to set NEXT_PUBLIC_APP_URL or NEXT_PUBLIC_API_URL here.

# ------------------------------------------------------------------------------
# PLATFORM SETTINGS
# ------------------------------------------------------------------------------
# Default Platform Settings
PLATFORM_NAME="AutoLumiku"
PLATFORM_MAX_TENANTS=1000
PLATFORM_MAX_USERS_PER_TENANT=50

# Default Indonesian Settings
DEFAULT_TIMEZONE="Asia/Jakarta"         # WIB, WITA: Asia/Makassar, WIT: Asia/Jayapura
DEFAULT_CURRENCY="IDR"
DEFAULT_LANGUAGE="id"                   # id (Indonesian), en (English)

# Tax Settings (Indonesia)
PPN_RATE=11                             # PPN (Pajak Pertambahan Nilai) - 11%
PPH23_RATE=2                            # PPh 23 for services - 2%

# ------------------------------------------------------------------------------
# REDIS CONFIGURATION (for caching and sessions)
# ------------------------------------------------------------------------------
REDIS_URL="redis://localhost:6379"
REDIS_PASSWORD=""                       # Leave empty if no password
REDIS_DB=0                             # Database number (0-15)

# ------------------------------------------------------------------------------
# FILE STORAGE CONFIGURATION
# ------------------------------------------------------------------------------
# Storage Provider: local, s3, cloudflare-r2
STORAGE_PROVIDER="local"

# Local Storage (Docker Volume)
UPLOAD_DIR="/app/uploads"                # Docker volume mount point
MAX_FILE_SIZE=10485760                  # 10MB in bytes
MAX_PHOTOS_PER_VEHICLE=30              # Maximum photos per vehicle

# AWS S3 Configuration (if STORAGE_PROVIDER=s3)
AWS_S3_BUCKET=""
AWS_S3_REGION="ap-southeast-1"
AWS_S3_ACCESS_KEY=""
AWS_S3_SECRET_KEY=""

# Cloudflare R2 Configuration (if STORAGE_PROVIDER=cloudflare-r2)
R2_ACCOUNT_ID=""
R2_ACCESS_KEY_ID=""
R2_SECRET_ACCESS_KEY=""
R2_BUCKET_NAME="autolumiku-vehicles"
R2_PUBLIC_URL=""                     # Public R2 bucket URL: https://pub-xxxxx.r2.dev

# ------------------------------------------------------------------------------
# MONITORING & LOGGING
# ------------------------------------------------------------------------------
# Log Level: error, warn, info, debug
LOG_LEVEL="info"

# Sentry Configuration (optional)
SENTRY_DSN=""
SENTRY_ENVIRONMENT="development"

# Analytics (optional)
GOOGLE_ANALYTICS_ID=""

# ------------------------------------------------------------------------------
# RATE LIMITING
# ------------------------------------------------------------------------------
# Rate limit configuration (requests per time window)
RATE_LIMIT_AUTH=5                       # Auth endpoints (per 15 minutes)
RATE_LIMIT_REFRESH=10                   # Refresh token (per minute)
RATE_LIMIT_API=100                      # General API (per minute)
RATE_LIMIT_SESSION=20                   # Session management (per minute)

# ------------------------------------------------------------------------------
# FEATURE FLAGS
# ------------------------------------------------------------------------------
# Feature toggles
FEATURE_AI_SUGGESTIONS="true"
FEATURE_AUTO_BACKUP="true"
FEATURE_TWO_FACTOR_AUTH="false"
FEATURE_MAINTENANCE_MODE="false"

# ------------------------------------------------------------------------------
# EPIC 2: AI-POWERED VEHICLE UPLOAD
# ------------------------------------------------------------------------------
# Z.AI API Configuration (GLM Models by Zhipu AI)
# Get your API key from: https://z.ai/manage-apikey/subscription
# IMPORTANT: For Z.AI subscription users, use regular endpoint (NOT /api/coding/)
ZAI_API_KEY="your-zai-api-key-here"
ZAI_BASE_URL="https://api.z.ai/api/paas/v4/"
ZAI_VISION_MODEL="glm-4v"            # For vehicle identification (vision)
ZAI_TEXT_MODEL="glm-4.6"             # Reasoning disabled via enable_reasoning=false parameter
API_TIMEOUT_MS="300000"              # 5 minutes timeout for AI operations

# Vehicle Upload Settings
MAX_PHOTOS_PER_VEHICLE=20
MAX_PHOTO_SIZE_MB=10
SUPPORTED_IMAGE_TYPES="image/jpeg,image/png,image/webp"

# Image Optimization Settings
IMAGE_QUALITY_WEBP=85                # WebP quality (0-100)
IMAGE_QUALITY_JPEG=90                # JPEG quality (0-100)
MIN_IMAGE_WIDTH=1024                 # Minimum width in pixels
MIN_IMAGE_HEIGHT=768                 # Minimum height in pixels

# ------------------------------------------------------------------------------
# EXTERNAL SERVICES (Optional)
# ------------------------------------------------------------------------------

# WhatsApp Business API (for notifications - Legacy)
WHATSAPP_BUSINESS_ACCOUNT_ID=""
WHATSAPP_ACCESS_TOKEN=""
WHATSAPP_PHONE_NUMBER_ID=""

# ------------------------------------------------------------------------------
# EPIC 8: WHATSAPP AI AUTOMATION - AIMEOW INTEGRATION
# ------------------------------------------------------------------------------
# Aimeow WhatsApp Business API (no authentication needed)
# Documentation: https://meow.lumiku.com/swagger/index.html
AIMEOW_BASE_URL="https://meow.lumiku.com"

# Webhook Secret for verifying incoming webhooks from Aimeow
# Generate with: openssl rand -hex 32
AIMEOW_WEBHOOK_SECRET="change-this-to-a-random-secret-for-webhook-verification"

# Webhook URL that Aimeow will send events to (configure in Aimeow dashboard)
# Format: https://yourdomain.com/api/v1/aimeow/webhook
# For local development with ngrok: https://xxxx.ngrok.io/api/v1/aimeow/webhook

# ------------------------------------------------------------------------------
# DEVELOPMENT ONLY
# ------------------------------------------------------------------------------
# Enable detailed error pages (DO NOT enable in production)
SHOW_ERROR_DETAILS="true"

# Enable Prisma query logging
DEBUG_PRISMA="false"

# Disable SSL verification (local development only)
NODE_TLS_REJECT_UNAUTHORIZED="0"

# ==============================================================================
# SECURITY NOTES
# ==============================================================================
# 1. NEVER commit this file with actual values to version control
# 2. Use strong, random values for JWT_SECRET (minimum 32 characters)
# 3. Rotate secrets regularly in production
# 4. Use different credentials for development, staging, and production
# 5. Enable 2FA for all production database and service accounts
# 6. Use IAM roles instead of access keys when possible (AWS/GCP)
# 7. Regularly audit access logs and rotate API keys
# ==============================================================================

# ==============================================================================
# PRODUCTION CHECKLIST
# ==============================================================================
# Before deploying to production, ensure:
# [ ] JWT_SECRET is set (64 char hex, generate: openssl rand -hex 64)
# [ ] JWT_REFRESH_SECRET is set (different from JWT_SECRET)
# [ ] SESSION_SECRET is set (64 char hex)
# [ ] DB_PASSWORD is set (strong password, no default)
# [ ] REDIS_PASSWORD is set (strong password, no default)
# [ ] DATABASE_URL points to production database with SSL enabled
# [ ] EMAIL_PROVIDER is set to "sendgrid" or "ses" (not "console")
# [ ] MIDTRANS_IS_PRODUCTION="true" with production credentials
# [ ] NODE_ENV="production"
# [ ] SHOW_ERROR_DETAILS="false"
# [ ] All API keys are production keys, not sandbox/test keys
# [ ] Redis is configured with password
# [ ] File storage uses S3 or R2 (not local)
# [ ] Sentry or monitoring is configured
# [ ] Rate limiting is enabled
# [ ] SSL certificates are valid
# [ ] Database backups are configured
# [ ] All secrets are stored securely (e.g., AWS Secrets Manager)
# ==============================================================================
